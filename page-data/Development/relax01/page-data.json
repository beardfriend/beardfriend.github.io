{"componentChunkName":"component---src-templates-blogpost-tsx","path":"/Development/relax01/","result":{"data":{"markdownRemark":{"html":"<p><strong>💡목표</strong></p>\n<ul>\n<li>Typeorm에서 DummyData seed심기..</li>\n</ul>\n<p><strong>⚡ 문제</strong></p>\n<ul>\n<li>Typeorm에선 seed를 기본으로 제공하지 않는다.</li>\n<li>미국 유명 프로그래머 Aaron Swartz 어디감??...</li>\n</ul>\n<h1 id=\"1-TypeOrm에서-seed-정책-수립\" style=\"position:relative;\">1. TypeOrm에서 seed 정책 수립<a href=\"#1-TypeOrm%EC%97%90%EC%84%9C-seed-%EC%A0%95%EC%B1%85-%EC%88%98%EB%A6%BD\" aria-label=\"1 TypeOrm에서 seed 정책 수립 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>ORM의 강자 Sequelize에서는 Seed를 위한 BulkInsert함수를 지원한다.<br>\nTypeOrm에서는 BulkInsert를 지원하지 않기 때문에 더미데이터를 입력하기 위해<br>\n직접 함수를 작성해야 한다.</p>\n<ol>\n<li>직접 SQL문을 작성해준다.</li>\n<li>TypeOrm의 내장된 기능 QueryBuilder를 사용한다.</li>\n</ol>\n<p>두 가지 방법 중 나는 두 번째 방법을 택했다.</p>\n<h2 id=\"11-Seed를-위한-Entity-작성\" style=\"position:relative;\">1.1. Seed를 위한 Entity 작성<a href=\"#11-Seed%EB%A5%BC-%EC%9C%84%ED%95%9C-Entity-%EC%9E%91%EC%84%B1\" aria-label=\"11 Seed를 위한 Entity 작성 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"javascript\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">@</span><span class=\"mtk11\">Entity</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">User</span><span class=\"mtk1\"> </span><span class=\"mtk4\">extends</span><span class=\"mtk1\"> </span><span class=\"mtk10\">Primary</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  @</span><span class=\"mtk11\">Column</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">email</span><span class=\"mtk1\">: </span><span class=\"mtk10\">string</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  @</span><span class=\"mtk11\">Column</span><span class=\"mtk1\">()</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">password</span><span class=\"mtk1\">: </span><span class=\"mtk10\">string</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  @</span><span class=\"mtk11\">Column</span><span class=\"mtk1\">({ </span><span class=\"mtk12\">nullable:</span><span class=\"mtk1\"> </span><span class=\"mtk4\">true</span><span class=\"mtk1\"> })</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk12\">phone_number</span><span class=\"mtk1\">: </span><span class=\"mtk10\">string</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">export</span><span class=\"mtk1\"> </span><span class=\"mtk12\">default</span><span class=\"mtk1\"> </span><span class=\"mtk12\">User</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p>간략하게 생성해주자 Entity를 작성해주자.<br>\n여기서 생략한 부분 ( Entitiy 데이터베이스 동기화, Orm과 데이터베이스 연결 등..)</p>\n<h2 id=\"12-Seed-Script로-생성\" style=\"position:relative;\">1.2. Seed Script로 생성<a href=\"#12-Seed-Script%EB%A1%9C-%EC%83%9D%EC%84%B1\" aria-label=\"12 Seed Script로 생성 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>타입스크립트 ts-node 기준으로 설명한다.<br>\n(ts-node는 tsc와 다르게 javascript로 컴파일 하지 않고 바로 실행한다.)</p>\n<h3 id=\"121-ts-node-script-설정방법\" style=\"position:relative;\">1.2.1. ts-node script 설정방법<a href=\"#121-ts-node-script-%EC%84%A4%EC%A0%95%EB%B0%A9%EB%B2%95\" aria-label=\"121 ts node script 설정방법 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\">npx typeorm migration:create</span></span></code></pre>\n<p>ts-node기준으로 위 명령어를 실행했을 때<br>\normConfig 파일에서 설정한 폴더에 migration파일이 생성되지 않았다.</p>\n<p>이유를 살펴보니, typescript에서 절대경로를 사용했기 때문이다.<br>\n따라서 절대경로를 포함하여 script를 실행해줘야 하고,<br>\ntypeOrm 공식문서에서는 node_modules에 설치된 cli를 이용하라고 적혀있다.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"json\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//package.json</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\"> </span><span class=\"mtk8\">&quot;migration:create&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;ts-node -r tsconfig-paths/register ../../node_modules/typeorm/cli.js migration:create -n $NAME&quot;</span></span></span></code></pre>\n<p>따라서 아래의 코드가 완성되는데,<br>\n현 프로젝트에서는 monorepo를 사용했기 때문에, node_modules의 위치가 tsconfig의 위치와 다르다.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"bash\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">$NAME</span><span class=\"mtk1\">=하고싶은이름 yarn migration:create</span></span></span></code></pre>\n<p>을 통해 migration create실행이 가능하다.</p>\n<p>처음 Seed를 설정할 때, 왜 대부분의 사람들이 migration을 이용할까? 라는 의문이 들었다.<br>\nmigration을 사용하면</p>\n<ol>\n<li>seed 코드를 작성해놓으면 재작성의 필요가 없다.</li>\n<li>rollback이 용이하다.</li>\n</ol>\n<h2 id=\"13-Seed-실행-revert-script-작성\" style=\"position:relative;\">1.3. Seed 실행, revert script 작성<a href=\"#13-Seed-%EC%8B%A4%ED%96%89-revert-script-%EC%9E%91%EC%84%B1\" aria-label=\"13 Seed 실행 revert script 작성 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"json\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">//package.json</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk8\">&quot;migration:run&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;ts-node -r tsconfig-paths/register ../../node_modules/typeorm/cli.js migration:run&quot;</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk8\">&quot;migration:revert&quot;</span><span class=\"mtk1\">: </span><span class=\"mtk8\">&quot;ts-node -r tsconfig-paths/register ../../node_modules/typeorm/cli.js migration:revert&quot;</span><span class=\"mtk1\">,</span></span></span></code></pre>\n<p>위와 같은 논리로 run과 revert를 작성해주면 된다.</p>\n<h1 id=\"2-Seed-코드-작성\" style=\"position:relative;\">2. Seed 코드 작성<a href=\"#2-Seed-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1\" aria-label=\"2 Seed 코드 작성 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<h2 id=\"21-Up-down\" style=\"position:relative;\">2.1. Up down<a href=\"#21-Up-down\" aria-label=\"21 Up down permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>위에서 설정한 create를 실행해보자.</p>\n<p>그럼 아래와 같은 코드가 생성될 거다.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"typescript\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SeedUser1643011552762</span><span class=\"mtk1\"> </span><span class=\"mtk4\">implements</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MigrationInterface</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">async</span><span class=\"mtk1\"> </span><span class=\"mtk11\">up</span><span class=\"mtk1\">(</span><span class=\"mtk12\">queryRunner</span><span class=\"mtk1\">: </span><span class=\"mtk10\">QueryRunner</span><span class=\"mtk1\">): </span><span class=\"mtk10\">Promise</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">void</span><span class=\"mtk1\">&gt; {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">async</span><span class=\"mtk1\"> </span><span class=\"mtk11\">down</span><span class=\"mtk1\">(</span><span class=\"mtk12\">queryRunner</span><span class=\"mtk1\">: </span><span class=\"mtk10\">QueryRunner</span><span class=\"mtk1\">): </span><span class=\"mtk10\">Promise</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">void</span><span class=\"mtk1\">&gt; {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk12\">export</span><span class=\"mtk1\"> </span><span class=\"mtk12\">default</span><span class=\"mtk1\"> </span><span class=\"mtk12\">SeedUser1643011552762</span><span class=\"mtk1\">;</span></span></span></code></pre>\n<p>up은 migration을 run할때 동작하는 함수고\ndown은 migration을 revert할때 동작하는 함수다.</p>\n<p>migration의 편리한 점은 database에 key값을 기록하여<br>\nmigration이 rollback됐는지, run됐는지를 확인할 수 있다.</p>\n<p>seed뿐만 아니라, column명 변경 or 추가 등에 용이하다.</p>\n<h2 id=\"22-seed-run-코드-작성\" style=\"position:relative;\">2.2. seed run 코드 작성<a href=\"#22-seed-run-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1\" aria-label=\"22 seed run 코드 작성 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>글 맨 상단에서 미국 유명 프로그래머 Aaron Swartz 어디감??...을<br>\n문제삼았다.</p>\n<p>이유는 이 사람이 많은 오픈소스를 오픈했다가 갑자기 어떤 이유에서인지<br>\n소스가 전부 날렸기 때문이다.</p>\n<p>이 사람이 만들어준 faker라는 npm module을 사용하려다 없어져서 놀랐다.<br>\nfaker는 자동으로 dummydata를 생성해주는 툴이다.</p>\n<p>대안으로 casual을 사용하기로 했다.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"typescript\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SeedUser1643011552762</span><span class=\"mtk1\"> </span><span class=\"mtk4\">implements</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MigrationInterface</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">async</span><span class=\"mtk1\"> </span><span class=\"mtk11\">up</span><span class=\"mtk1\">(): </span><span class=\"mtk10\">Promise</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">void</span><span class=\"mtk1\">&gt; {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">value</span><span class=\"mtk1\">: {}[] = [];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">for</span><span class=\"mtk1\"> (</span><span class=\"mtk4\">let</span><span class=\"mtk1\"> </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> = </span><span class=\"mtk7\">0</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> &lt; </span><span class=\"mtk7\">100</span><span class=\"mtk1\">; </span><span class=\"mtk12\">i</span><span class=\"mtk1\"> += </span><span class=\"mtk7\">1</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk4\">const</span><span class=\"mtk1\"> </span><span class=\"mtk12\">test</span><span class=\"mtk1\"> = {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">email:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">casual</span><span class=\"mtk1\">.</span><span class=\"mtk12\">email</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">password:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">casual</span><span class=\"mtk1\">.</span><span class=\"mtk12\">password</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">phone_number:</span><span class=\"mtk1\"> </span><span class=\"mtk12\">casual</span><span class=\"mtk1\">.</span><span class=\"mtk12\">phone</span><span class=\"mtk1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      };</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk12\">value</span><span class=\"mtk1\">.</span><span class=\"mtk11\">push</span><span class=\"mtk1\">(</span><span class=\"mtk12\">test</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk12\">value</span><span class=\"mtk1\">.</span><span class=\"mtk12\">length</span><span class=\"mtk1\"> === </span><span class=\"mtk7\">0</span><span class=\"mtk1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk15\">return</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk11\">getConnection</span><span class=\"mtk1\">().</span><span class=\"mtk11\">createQueryBuilder</span><span class=\"mtk1\">().</span><span class=\"mtk11\">insert</span><span class=\"mtk1\">().</span><span class=\"mtk11\">into</span><span class=\"mtk1\">(</span><span class=\"mtk12\">User</span><span class=\"mtk1\">).</span><span class=\"mtk11\">values</span><span class=\"mtk1\">(</span><span class=\"mtk12\">value</span><span class=\"mtk1\">).</span><span class=\"mtk11\">execute</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>npm가이드대로 casual.원하는값 을 해주면<br>\n랜덤하게 값을 출력해준다.<br>\nemail,password,phone외에도 다양한 dummydata형식을 지원한다.</p>\n<p>코드는 아주 간단하다.<br>\n100개의 더미데이터를 User Entity에 넣어주는 것이다.</p>\n<h2 id=\"23-seed-revert-코드-작성\" style=\"position:relative;\">2.3. seed revert 코드 작성<a href=\"#23-seed-revert-%EC%BD%94%EB%93%9C-%EC%9E%91%EC%84%B1\" aria-label=\"23 seed revert 코드 작성 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>롤백 코드도 작성해보자.</p>\n<pre class=\"grvsc-container dark-default-dark\" data-language=\"typescript\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">class</span><span class=\"mtk1\"> </span><span class=\"mtk10\">SeedUser1643011552762</span><span class=\"mtk1\"> </span><span class=\"mtk4\">implements</span><span class=\"mtk1\"> </span><span class=\"mtk10\">MigrationInterface</span><span class=\"mtk1\"> {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk4\">public</span><span class=\"mtk1\"> </span><span class=\"mtk4\">async</span><span class=\"mtk1\"> </span><span class=\"mtk11\">down</span><span class=\"mtk1\">(</span><span class=\"mtk12\">queryRunner</span><span class=\"mtk1\">: </span><span class=\"mtk10\">QueryRunner</span><span class=\"mtk1\">): </span><span class=\"mtk10\">Promise</span><span class=\"mtk1\">&lt;</span><span class=\"mtk10\">void</span><span class=\"mtk1\">&gt; {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">await</span><span class=\"mtk1\"> </span><span class=\"mtk12\">queryRunner</span><span class=\"mtk1\">.</span><span class=\"mtk11\">query</span><span class=\"mtk1\">(</span><span class=\"mtk8\">`truncate table public.user cascade;`</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>psql을 사용하는데, truncate를 이용하여 row 데이터를 모두 날리는 쿼리다.</p>\n<p>저장한 뒤</p>\n<h1 id=\"3-Seeding-하기\" style=\"position:relative;\">3. Seeding 하기<a href=\"#3-Seeding-%ED%95%98%EA%B8%B0\" aria-label=\"3 Seeding 하기 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>위에서 작성해준 스크립트를 실행해주면 된다.</p>\n<h1 id=\"4-마치며\" style=\"position:relative;\">4. 마치며<a href=\"#4-%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"4 마치며 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>실제로 버전관리가 필요한 migration과<br>\nlocal에서 test용으로 작성하는 dummy용 migration seeding은 폴더를 나눠<br>\n관리할 필요가 있겠다.</p>\n<p>package를 오픈소스로 풀어주는 사람들에게<br>\n항상 감사함을 느낀다.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .dark-default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .dark-default-dark .mtk1 { color: #D4D4D4; }\n  .dark-default-dark .mtk11 { color: #DCDCAA; }\n  .dark-default-dark .mtk4 { color: #569CD6; }\n  .dark-default-dark .mtk10 { color: #4EC9B0; }\n  .dark-default-dark .mtk12 { color: #9CDCFE; }\n  .dark-default-dark .mtk3 { color: #6A9955; }\n  .dark-default-dark .mtk8 { color: #CE9178; }\n  .dark-default-dark .mtk15 { color: #C586C0; }\n  .dark-default-dark .mtk7 { color: #B5CEA8; }\n  .dark-default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","featuredImg":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkklEQVQoz6WSsQrFIAxF3Z9IgzHR2SXfIO3kh3QsfojQtUPBz33gW1uwfWcN53JJotwfqLsBEb2UEREAiIg7d0Hq0vTei4gx5tMBgCGZmbXW8zyf57ltWyllXdeU0q/IkLwsy3Ec+77XWltrOWetNTMP1Q4hiIi1NsbovSciRHywsGmanHMAcKkNnYo6j+WRJ/kCd789DA6TsQMAAAAASUVORK5CYII=","aspectRatio":2,"src":"/static/d69521d8ac0792af6e325f6833bbca06/17c4b/R1280x0.png","srcSet":"/static/d69521d8ac0792af6e325f6833bbca06/69585/R1280x0.png 200w,\n/static/d69521d8ac0792af6e325f6833bbca06/497c6/R1280x0.png 400w,\n/static/d69521d8ac0792af6e325f6833bbca06/17c4b/R1280x0.png 743w","sizes":"(max-width: 743px) 100vw, 743px"}}},"frontmatter":{"date":"January 25, 2022","subtitle":"Relax(01)","title":"typeOrm seeding"},"headings":[{"depth":1,"id":"1-TypeOrm에서-seed-정책-수립","value":"1. TypeOrm에서 seed 정책 수립"},{"depth":2,"id":"11-Seed를-위한-Entity-작성","value":"1.1. Seed를 위한 Entity 작성"},{"depth":2,"id":"12-Seed-Script로-생성","value":"1.2. Seed Script로 생성"},{"depth":3,"id":"121-ts-node-script-설정방법","value":"1.2.1. ts-node script 설정방법"},{"depth":2,"id":"13-Seed-실행-revert-script-작성","value":"1.3. Seed 실행, revert script 작성"},{"depth":1,"id":"2-Seed-코드-작성","value":"2. Seed 코드 작성"},{"depth":2,"id":"21-Up-down","value":"2.1. Up down"},{"depth":2,"id":"22-seed-run-코드-작성","value":"2.2. seed run 코드 작성"},{"depth":2,"id":"23-seed-revert-코드-작성","value":"2.3. seed revert 코드 작성"},{"depth":1,"id":"3-Seeding-하기","value":"3. Seeding 하기"},{"depth":1,"id":"4-마치며","value":"4. 마치며"}]}},"pageContext":{"slug":"/Development/relax01/"}},"staticQueryHashes":[]}